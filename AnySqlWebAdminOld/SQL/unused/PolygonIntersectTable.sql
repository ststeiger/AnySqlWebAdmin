

;WITH CTE_Poly AS 
(
	          SELECT 'a' AS id, geography::STPolyFromText('POLYGON((-122.358 47.653, -122.348 47.649, -122.348 47.658, -122.358 47.658, -122.358 47.653))', 4326) AS poly 
	UNION ALL SELECT 'b' AS id, geography::STPolyFromText('POLYGON((0 0, 0 1, 1 1, 1 0, 0 0))', 4326) AS poly 
)
,CTE_Points AS 
(
	--           SELECT 1 AS id, geography::Point(47.653, -122.358, 4326) AS point 
	-- UNION ALL SELECT 2 AS id, geography::Point(47.653, -122.358, 4326) AS point 

	-- UNION ALL 
	
	SELECT 
		 ROW_NUMBER() OVER (ORDER BY GB_UID) AS id 
		,geography::Point(T_AP_Gebaeude.GB_GM_Lat, T_AP_Gebaeude.GB_GM_Lng, 4326) AS point 
	FROM T_AP_Gebaeude 
	WHERE (1=1) 
	AND T_AP_Gebaeude.GB_Status= 1 
	AND CURRENT_TIMESTAMP BETWEEN T_AP_Gebaeude.GB_DatumVon AND T_AP_Gebaeude.GB_DatumBis 
)
SELECT * FROM CTE_Points 
CROSS JOIN CTE_Poly 
WHERE poly.STIntersects(point) = 1 





----------------------------

-- JavaScript: array.reverse();

-- oberes 1: 
DECLARE @oberes1 geography;  
SET @oberes1 = geography::STPolyFromText('POLYGON((7.5998247 47.551897,7.5998202 47.5518961,7.599821 47.5518902,7.5998177 47.5518896,7.5998137 47.5518949,7.5997766 47.551888,7.5997772 47.551882,7.5997738 47.5518814,7.5997697 47.5518867,7.5997296 47.5518792,7.5997302 47.5518732,7.5997265 47.5518725,7.5997224 47.5518778,7.5996817 47.5518702,7.5996822 47.5518643,7.5996789 47.5518637,7.599675 47.551869,7.5996349 47.5518615,7.599635 47.5518555,7.5996319 47.5518549,7.599628 47.5518602,7.5995871 47.5518526,7.5995878 47.5518466,7.5995846 47.551846,7.5995805 47.5518513,7.5995398 47.5518438,7.5995406 47.5518378,7.5995374 47.5518372,7.5995332 47.5518425,7.5995202 47.5518401,7.5995092 47.5518672,7.5995004 47.5518668,7.5994994 47.5518693,7.5995074 47.5518718,7.5994961 47.5518995,7.5994873 47.5518991,7.5994863 47.5519014,7.5994942 47.5519042,7.5994831 47.5519313,7.5994742 47.5519312,7.5994732 47.5519337,7.5994811 47.5519362,7.5994698 47.5519639,7.5994828 47.5519663,7.5994821 47.5519723,7.5994856 47.5519729,7.5994894 47.5519676,7.5995298 47.5519751,7.5995293 47.551981,7.5995324 47.5519816,7.5995367 47.5519764,7.5995779 47.551984,7.5995772 47.5519899,7.5995807 47.5519906,7.5995844 47.5519852,7.5996246 47.5519927,7.5996243 47.5519987,7.5996276 47.5519993,7.5996317 47.551994,7.5996717 47.5520014,7.5996714 47.5520074,7.5996744 47.552008,7.5996788 47.5520028,7.5997189 47.5520102,7.5997186 47.5520162,7.5997218 47.5520168,7.5997262 47.5520116,7.5997667 47.5520191,7.599766 47.552025,7.5997693 47.5520256,7.599774 47.5520205,7.5998137 47.5520278,7.5998137 47.5520339,7.5998172 47.5520345,7.5998208 47.5520292,7.5998383 47.5520324,7.5998615 47.5520367,7.599861 47.5520427,7.5998642 47.5520433,7.5998683 47.552038,7.5999094 47.5520456,7.5999084 47.5520515,7.5999115 47.5520521,7.5999158 47.5520468,7.5999566 47.5520544,7.5999557 47.5520603,7.5999591 47.5520609,7.5999633 47.5520556,7.6000039 47.5520632,7.6000032 47.5520691,7.6000064 47.5520697,7.6000103 47.5520644,7.6000507 47.5520719,7.6000501 47.5520778,7.6000537 47.5520785,7.600057 47.5520731,7.6000981 47.5520807,7.6000979 47.5520867,7.6001008 47.5520873,7.6001044 47.5520819,7.6001194 47.5520849,7.6001709 47.5519579,7.6001699 47.5519577,7.6001692 47.5519594,7.6001651 47.5519596,7.6001537 47.5519584,7.600155 47.5519526,7.6001513 47.5519519,7.600147 47.5519571,7.6001059 47.5519495,7.6001074 47.5519437,7.6001037 47.551943,7.6000998 47.5519483,7.6000593 47.5519408,7.6000605 47.5519349,7.6000568 47.5519342,7.6000527 47.5519395,7.6000121 47.551932,7.600013 47.5519261,7.6000094 47.5519254,7.6000056 47.5519307,7.5999649 47.5519231,7.5999658 47.5519172,7.5999621 47.5519166,7.5999583 47.5519219,7.5999175 47.5519143,7.5999183 47.5519084,7.5999148 47.5519077,7.5999109 47.5519131,7.5998711 47.5519056,7.5998715 47.5518996,7.5998675 47.5518989,7.5998638 47.5519043,7.5998513 47.5519019,7.5998247 47.551897))', 4326)

-- oberes 2: 
DECLARE @oberes2 geography;  
SET @oberes2 = geography::STPolyFromText('POLYGON((7.5998513 47.5519019,7.5998697 47.5518585,7.5998715 47.5518607,7.5998755 47.5518599,7.5998744 47.5518575,7.5998877 47.5518548,7.5998975 47.5518617,7.5998949 47.5518635,7.5998975 47.5518654,7.5999002 47.5518636,7.5999218 47.5518787,7.5999191 47.5518804,7.5999221 47.5518825,7.5999247 47.5518807,7.5999367 47.5518891,7.5999541 47.551886,7.599955 47.5518885,7.5999587 47.5518878,7.5999578 47.5518854,7.5999879 47.5518801,7.5999888 47.5518826,7.5999928 47.5518819,7.5999918 47.5518794,7.600022 47.5518741,7.6000229 47.5518766,7.6000271 47.5518759,7.6000261 47.5518734,7.6000561 47.5518682,7.600057 47.5518706,7.6000609 47.55187,7.60006 47.5518675,7.6000767 47.5518646,7.6000815 47.551853,7.6000851 47.5518537,7.600086 47.5518514,7.6000824 47.5518508,7.6000909 47.5518302,7.6000945 47.5518309,7.6000956 47.5518283,7.600092 47.5518277,7.6000967 47.5518163,7.6000845 47.5518079,7.6000872 47.5518061,7.600084 47.5518039,7.6000813 47.5518057,7.6000598 47.5517909,7.6000625 47.5517891,7.6000598 47.5517872,7.6000571 47.551789,7.6000351 47.5517738,7.6000378 47.551772,7.6000349 47.55177,7.6000322 47.5517718,7.6000102 47.5517566,7.6000128 47.5517548,7.6000103 47.5517531,7.6000077 47.5517548,7.5999958 47.5517467,7.599979 47.5517496,7.5999781 47.5517472,7.5999742 47.5517478,7.5999751 47.5517503,7.5999611 47.5517527,7.5999513 47.551746,7.599954 47.5517443,7.5999512 47.5517423,7.5999485 47.5517441,7.5999264 47.5517289,7.5999291 47.5517272,7.5999261 47.5517252,7.5999235 47.5517269,7.5999015 47.5517118,7.5999041 47.5517101,7.5999013 47.5517081,7.5998987 47.5517099,7.5998766 47.5516948,7.5998793 47.551693,7.5998766 47.5516912,7.599874 47.551693,7.5998615 47.5516847,7.5998449 47.5516877,7.5998439 47.5516851,7.5998403 47.5516857,7.5998413 47.5516883,7.5998257 47.5516911,7.5998161 47.5516845,7.599819 47.5516826,7.5998164 47.5516808,7.5998135 47.5516828,7.5997913 47.5516675,7.5997942 47.5516655,7.5997916 47.5516638,7.5997887 47.5516657,7.5997795 47.5516594,7.5997838 47.5516488,7.5997875 47.5516495,7.5997885 47.5516471,7.5997848 47.5516464,7.5997932 47.5516258,7.5997969 47.5516265,7.5997979 47.5516241,7.5997942 47.5516234,7.5997988 47.5516121,7.5997869 47.5516038,7.5997895 47.551602,7.5997867 47.5516001,7.5997841 47.5516019,7.599762 47.5515867,7.5997646 47.551585,7.5997619 47.5515831,7.5997593 47.5515849,7.5997472 47.5515766,7.599731 47.5515795,7.5997301 47.5515771,7.5997259 47.5515779,7.5997269 47.5515803,7.5996972 47.5515856,7.5996962 47.5515832,7.599692 47.551584,7.599693 47.5515864,7.599676 47.5515895,7.5996716 47.5516004,7.599668 47.5515997,7.5996669 47.5516023,7.5996705 47.551603,7.5996622 47.5516234,7.5996586 47.5516227,7.5996575 47.5516254,7.5996611 47.5516261,7.5996574 47.5516353,7.5996433 47.5516378,7.5996423 47.5516354,7.5996385 47.5516361,7.5996394 47.5516385,7.5996095 47.5516439,7.5996085 47.5516414,7.5996046 47.5516421,7.5996055 47.5516446,7.599589 47.5516475,7.5995847 47.5516581,7.5995812 47.5516574,7.5995801 47.5516599,7.5995837 47.5516606,7.5995754 47.5516812,7.5995718 47.5516805,7.5995707 47.5516832,7.5995743 47.5516838,7.5995697 47.5516952,7.5995815 47.5517033,7.5995791 47.5517053,7.5995821 47.5517069,7.5995842 47.5517052,7.5996063 47.5517205,7.5996037 47.5517222,7.5996064 47.5517241,7.5996091 47.5517224,7.5996211 47.5517308,7.5996378 47.5517278,7.5996388 47.5517304,7.5996424 47.5517297,7.5996414 47.5517272,7.5996553 47.5517247,7.5996653 47.5517316,7.5996625 47.5517334,7.5996651 47.5517352,7.5996679 47.5517334,7.5997281 47.5517749,7.5996944 47.5517811,7.5997055 47.5517887,7.5997028 47.5517905,7.5997054 47.5517923,7.5997081 47.5517905,7.5997202 47.5517988,7.599737 47.5517958,7.5997379 47.5517983,7.5997418 47.5517976,7.5997408 47.5517951,7.5997716 47.5517896,7.5997726 47.551792,7.5997765 47.5517913,7.5997755 47.5517889,7.5997883 47.5517866,7.599799 47.5517939,7.5997963 47.5517957,7.5997991 47.5517976,7.5998017 47.5517958,7.5998239 47.5518111,7.5998213 47.5518129,7.599824 47.5518148,7.5998267 47.551813,7.5998365 47.5518198,7.5998326 47.551829,7.599829 47.5518283,7.5998279 47.5518309,7.5998315 47.5518316,7.5998269 47.5518423,7.5998388 47.5518505,7.5998362 47.5518523,7.5998389 47.5518541,7.5998422 47.5518528,7.5998247 47.551897,7.5998513 47.5519019))', 4326)


-- unteres 1:
DECLARE @unteres1 geography;  
SET @unteres1 = geography::STPolyFromText('POLYGON((7.5989804 47.5512929,7.5989946 47.551304,7.5989913 47.5513072,7.5989936 47.551309,7.5989986 47.5513071,7.5990274 47.5513296,7.599024 47.5513329,7.5990263 47.5513348,7.5990314 47.5513327,7.59906 47.551355,7.5990563 47.5513583,7.5990589 47.5513604,7.5990643 47.5513584,7.5990928 47.5513806,7.5990889 47.551384,7.5990913 47.5513859,7.599097 47.551384,7.5991152 47.5513981,7.5992518 47.5513191,7.5992923 47.5513511,7.599248 47.551377,7.5993337 47.5514442,7.5994706 47.551364,7.5993856 47.5512967,7.5993219 47.5513338,7.5992782 47.5512981,7.5992834 47.5512999,7.5992865 47.551298,7.5992837 47.5512947,7.5992996 47.551285,7.5992832 47.5512722,7.5992995 47.5512627,7.5993049 47.5512653,7.5993076 47.5512637,7.5993046 47.5512598,7.5993376 47.5512407,7.5993427 47.5512434,7.5993455 47.5512418,7.5993423 47.5512379,7.5993754 47.5512188,7.5993808 47.5512213,7.5993838 47.5512196,7.5993804 47.5512159,7.5993958 47.551207,7.5992655 47.5511049,7.5992505 47.5511136,7.5992453 47.551111,7.5992423 47.5511128,7.5992453 47.5511167,7.5992123 47.5511358,7.5992073 47.551133,7.5992043 47.5511348,7.5992073 47.5511387,7.5991748 47.5511575,7.5991696 47.5511549,7.5991668 47.5511566,7.5991696 47.5511606,7.5991371 47.5511795,7.5991318 47.5511769,7.5991291 47.5511784,7.5991321 47.5511824,7.5991178 47.5511907,7.5990993 47.5512014,7.5990939 47.5511988,7.5990911 47.5512004,7.5990943 47.5512043,7.5990778 47.5512139,7.5990942 47.5512266,7.5990774 47.5512364,7.5990722 47.5512336,7.5990692 47.5512354,7.5990723 47.5512393,7.5990398 47.5512583,7.5990342 47.5512556,7.5990315 47.5512572,7.5990346 47.5512613,7.5990021 47.5512803,7.5989966 47.5512774,7.5989937 47.5512791,7.5989968 47.5512834,7.5989804 47.5512929))', 4326)


-- unteres 2: 
DECLARE @unteres2 geography;  
SET @unteres2 = geography::STPolyFromText('POLYGON((7.5993631 47.5509978,7.5993605 47.5509993,7.5993632 47.5510033,7.5993472 47.5510126,7.5993615 47.5510237,7.5993569 47.5510274,7.5993593 47.5510293,7.5993658 47.5510271,7.5993802 47.5510383,7.5993634 47.551048,7.5993584 47.5510454,7.5993557 47.551047,7.5993585 47.5510509,7.5993255 47.55107,7.5993206 47.5510674,7.5993178 47.551069,7.5993207 47.5510729,7.5992882 47.5510917,7.5992829 47.5510892,7.5992803 47.5510907,7.599283 47.5510947,7.5992655 47.5511049,7.5993958 47.551207,7.5994132 47.5511969,7.5994186 47.5511995,7.5994214 47.5511978,7.5994181 47.551194,7.599451 47.551175,7.5994562 47.5511776,7.599459 47.551176,7.599456 47.5511721,7.599489 47.5511529,7.5994942 47.5511556,7.5994969 47.5511541,7.5994938 47.5511501,7.5995101 47.5511407,7.5995244 47.5511519,7.5995204 47.5511553,7.599523 47.5511573,7.5995287 47.5511552,7.5995571 47.5511776,7.5995532 47.5511809,7.5995557 47.5511829,7.5995613 47.5511809,7.5995896 47.551203,7.5995855 47.5512063,7.5995881 47.5512083,7.5995939 47.5512064,7.5996222 47.5512286,7.5996182 47.5512319,7.5996207 47.5512338,7.5996264 47.5512319,7.5996544 47.5512539,7.5996507 47.5512573,7.5996532 47.5512593,7.5996588 47.5512574,7.5996618 47.5512599,7.5998186 47.5511762,7.5998096 47.5511692,7.5998134 47.551166,7.5998107 47.5511638,7.5998051 47.5511657,7.5997771 47.5511437,7.5997807 47.5511402,7.5997784 47.5511384,7.5997732 47.5511406,7.5997448 47.5511183,7.5997484 47.5511149,7.599746 47.5511129,7.5997408 47.5511152,7.5997121 47.5510926,7.5997157 47.5510892,7.5997134 47.5510873,7.599708 47.5510894,7.5996794 47.5510669,7.599683 47.5510634,7.5996807 47.5510616,7.5996752 47.5510636,7.5996474 47.5510417,7.5996508 47.5510381,7.5996485 47.5510363,7.599643 47.5510383,7.5996144 47.5510159,7.599618 47.5510123,7.5996158 47.5510106,7.5996104 47.5510126,7.5995823 47.5509906,7.5995857 47.550987,7.5995832 47.550985,7.5995778 47.550987,7.5995494 47.5509647,7.599553 47.5509613,7.5995507 47.5509595,7.5995451 47.5509614,7.599517 47.5509392,7.5995206 47.5509358,7.5995179 47.5509337,7.5995125 47.5509357,7.5994984 47.5509246,7.599482 47.5509342,7.5994765 47.5509318,7.5994737 47.5509334,7.5994768 47.5509372,7.5994442 47.5509562,7.5994388 47.5509537,7.599436 47.5509554,7.5994391 47.5509592,7.5994062 47.5509783,7.599401 47.5509757,7.5993983 47.5509773,7.5994011 47.5509813,7.5993839 47.5509913,7.5993682 47.5510004,7.5993631 47.5509978))', 4326)


